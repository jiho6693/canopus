<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NOINSEONG — gradient + permission</title>
  <style>
    html,body{
      height:100%;
      margin:0;
      background:#050506;
      overflow:hidden;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
                   "Liberation Mono","Courier New", monospace;
    }

    /* ───────── 배경 스테이지 ───────── */
    .stage{
      position:fixed;
      inset:0;
      background: radial-gradient(1200px 900px at 50% 55%,
        rgba(0,0,0,0.00) 0%,
        rgba(0,0,0,0.65) 55%,
        rgba(0,0,0,0.98) 88%);
      transition: background 1.2s ease;
    }

    /* ───────── 중앙 위치 허용 오버레이 ───────── */
    .overlay{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,0.35);
      backdrop-filter: blur(4px);
      z-index:10;
      opacity:1;
      transition: opacity .8s ease;
    }
    .overlay.hidden{
      opacity:0;
      pointer-events:none;
    }

    .panel{
      text-align:center;
      padding:22px 26px;
      border-radius:14px;
      background: rgba(10,8,9,0.55);
      border:1px solid rgba(255,255,255,0.14);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      max-width: 280px;
    }

    .panel p{
      margin:0 0 14px 0;
      font-size:13px;
      line-height:1.45;
      color: rgba(255,255,255,0.75);
      letter-spacing:0.01em;
    }

    .panel button{
      padding:10px 14px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.85);
      font-size:12px;
      cursor:pointer;
      backdrop-filter: blur(6px);
    }

    .panel .note{
      margin-top:10px;
      font-size:11px;
      color: rgba(255,255,255,0.45);
    }
  </style>
</head>
<body>

  <!-- 배경 -->
  <div class="stage" id="stage"></div>

  <!-- 중앙 위치 허용 오버레이 -->
  <div class="overlay" id="overlay">
    <div class="panel">
      <p>
        이 화면은 사용자의 위치에 따라<br>
        밝기가 달라집니다.
      </p>
      <button id="allowBtn">위치 허용</button>
      <div class="note">
        위치 정보는 저장되지 않습니다.
      </div>
    </div>
  </div>

<script>
/**
 * 그라데이션 버전 + 중앙 위치 허용
 * iOS Safari / 전시 안정화
 */

const LIMIT = 37.8;
const JEJU  = 33.0;
const BUSAN = 35.1;
const SEOUL = 37.6;

// 서울에서의 최소 가시성 (조절 포인트)
const SEOUL_VIS = 0.42;

// 그라데이션 강도 (과하지 않게)
const centerGain = 0.18; // 중앙 밝기
const edgeDark   = 0.96; // 가장자리 어둠

const stage   = document.getElementById('stage');
const overlay = document.getElementById('overlay');
const allowBtn = document.getElementById('allowBtn');

const clamp01 = x => Math.max(0, Math.min(1, x));
const smoothstep = (e0,e1,x)=>{
  const t = clamp01((x-e0)/(e1-e0));
  return t*t*(3-2*t);
};

function visibilityFromLat(lat){
  if (lat >= LIMIT) return 0;

  const base = 1 - smoothstep(JEJU, SEOUL, lat);
  let vis = SEOUL_VIS + (1 - SEOUL_VIS) * base;

  // 컷오프 직전 급감
  const nearCut = 1 - smoothstep(LIMIT - 0.10, LIMIT, lat);
  vis *= nearCut;

  return clamp01(vis);
}

function rednessFromLat(lat){
  return smoothstep(BUSAN, LIMIT, lat);
}

function setBlack(){
  stage.style.background = `radial-gradient(1200px 900px at 50% 55%,
    rgba(0,0,0,0.00) 0%,
    rgba(0,0,0,0.65) 55%,
    rgba(0,0,0,0.98) 88%)`;
}

function applyState(lat){
  if (lat >= LIMIT){
    setBlack();
    overlay.classList.add('hidden');
    return;
  }

  const vis = visibilityFromLat(lat);
  const red = rednessFromLat(lat);

  // 황백 중심 + 대기 왜곡(적갈) 아주 미세
  const coreA = (0.02 + centerGain * vis).toFixed(3);
  const warmA = (0.01 + 0.10 * vis).toFixed(3);
  const redA  = (0.00 + 0.06 * vis * red).toFixed(3);

  const midA  = (0.10 + 0.10 * vis).toFixed(3);
  const edgeA = (edgeDark + 0.03 * (1 - vis)).toFixed(3);

  stage.style.background = `
    radial-gradient(1200px 900px at 50% 55%,
      rgba(255,252,235,${coreA}) 0%,
      rgba(255,215,170,${warmA}) 32%,
      rgba(255,150,120,${redA}) 48%,
      rgba(10,6,8,${midA}) 70%,
      rgba(0,0,0,${edgeA}) 92%
    )
  `;

  overlay.classList.add('hidden');
}

function requestLocation(){
  if (!('geolocation' in navigator)){
    setBlack();
    return;
  }

  navigator.geolocation.getCurrentPosition(
    pos => applyState(pos.coords.latitude),
    err => {
      // 실패/거부 시: 오버레이 유지
      setBlack();
      overlay.classList.remove('hidden');
    },
    { enableHighAccuracy:false, timeout:12000, maximumAge:300000 }
  );
}

allowBtn.addEventListener('click', requestLocation);
</script>
</body>
</html>
