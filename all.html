<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NOINSEONG — permission center</title>
  <style>
    html,body{
      height:100%;
      margin:0;
      background:#050506;
      overflow:hidden;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
                   "Liberation Mono","Courier New", monospace;
    }
    body{
      transition: background 1.2s ease;
    }

    /* ───────── 중앙 오버레이 ───────── */
    .overlay{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,0.35);
      backdrop-filter: blur(4px);
      z-index:10;
      opacity:1;
      transition: opacity .8s ease;
    }
    .overlay.hidden{
      opacity:0;
      pointer-events:none;
    }

    .panel{
      text-align:center;
      padding:22px 26px;
      border-radius:14px;
      background: rgba(10,8,9,0.55);
      border:1px solid rgba(255,255,255,0.14);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      max-width: 280px;
    }

    .panel p{
      margin:0 0 14px 0;
      font-size:13px;
      line-height:1.45;
      color: rgba(255,255,255,0.75);
      letter-spacing:0.01em;
    }

    .panel button{
      padding:10px 14px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.85);
      font-size:12px;
      cursor:pointer;
      backdrop-filter: blur(6px);
    }

    .panel .note{
      margin-top:10px;
      font-size:11px;
      color: rgba(255,255,255,0.45);
    }
  </style>
</head>
<body>

  <!-- 중앙 위치 허용 오버레이 -->
  <div class="overlay" id="overlay">
    <div class="panel">
      <p>
        이 화면은 사용자의 위치에 따라<br>
        밝기가 달라집니다.
      </p>
      <button id="allowBtn">위치 허용</button>
      <div class="note">
        위치 정보는 저장되지 않습니다.
      </div>
    </div>
  </div>

<script>
/**
 * 플랫 밝기 + 중앙 위치 허용 UI
 * iOS Safari 안정화 버전
 */

const LIMIT = 37.8;
const JEJU  = 33.0;
const BUSAN = 35.1;
const SEOUL = 37.6;

// 서울 기준 최소 밝기
const SEOUL_VIS = 0.42;

const overlay = document.getElementById('overlay');
const allowBtn = document.getElementById('allowBtn');

const clamp01 = x => Math.max(0, Math.min(1, x));
const smoothstep = (e0,e1,x)=>{
  const t = clamp01((x-e0)/(e1-e0));
  return t*t*(3-2*t);
};

function visibilityFromLat(lat){
  if (lat >= LIMIT) return 0;

  const base = 1 - smoothstep(JEJU, SEOUL, lat);
  let vis = SEOUL_VIS + (1 - SEOUL_VIS) * base;

  const nearCut = 1 - smoothstep(LIMIT - 0.10, LIMIT, lat);
  vis *= nearCut;

  return clamp01(vis);
}

function rednessFromLat(lat){
  return smoothstep(BUSAN, LIMIT, lat);
}

function setBlack(){
  document.body.style.background = `rgb(0,0,0)`;
}

function applyState(lat){
  if (lat >= LIMIT){
    setBlack();
    overlay.classList.add('hidden');
    return;
  }

  const vis = visibilityFromLat(lat);
  const red = rednessFromLat(lat);

  // 황백 기본 톤
  const r = 255, g = 252, b = 235;

  const baseA = 0.05 + 0.60 * vis;
  const redShift = 0.08 * vis * red;

  document.body.style.background =
    `rgba(${r},${g},${b},${baseA + redShift})`;

  overlay.classList.add('hidden');
}

function requestLocation(){
  if (!('geolocation' in navigator)){
    setBlack();
    return;
  }

  navigator.geolocation.getCurrentPosition(
    pos => applyState(pos.coords.latitude),
    err => {
      // 거부/실패 시: 오버레이 유지 (다시 누를 수 있게)
      setBlack();
      overlay.classList.remove('hidden');
    },
    { enableHighAccuracy:false, timeout:12000, maximumAge:300000 }
  );
}

allowBtn.addEventListener('click', requestLocation);
</script>
</body>
</html>
