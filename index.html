<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NOINSEONG — 위치에 따른 밝기</title>
  <style>
    :root{
      --bg:#050506;

      /* 황백빛(코어) / 적갈(대기왜곡) */
      --core: rgba(255,252,235,0.0);
      --warm: rgba(255,215,170,0.0);
      --red:  rgba(255,150,120,0.0);

      --hint: rgba(255,255,255,0.0);
    }
    html,body{height:100%; margin:0; background:var(--bg); overflow:hidden;}
    body{
      display:flex; align-items:center; justify-content:center;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }

    /* 배경 전체: 중앙이 약간 밝고 가장자리가 어두운, 완만한 그라데이션 */
    .stage{
      position:fixed; inset:0;
      background: radial-gradient(1200px 900px at 50% 55%,
        rgba(255,252,235,0.00) 0%,
        rgba(20,10,12,0.08) 45%,
        rgba(0,0,0,0.96) 85%);
      transition: background 1.2s ease;
    }

    /* (선택) 아주 미세한 지평선 */
    .horizon{
      position:fixed; left:0; right:0; bottom:10%;
      height:1px;
      background: rgba(255,255,255,0.0);
      opacity: 0;
      transition: opacity 1.2s ease, background 1.2s ease;
      pointer-events:none;
    }

    .hint{
      position:fixed; left:16px; right:16px; bottom:14px;
      font-size:12px; line-height:1.35;
      color: var(--hint);
      opacity: 0;
      transition: opacity 0.8s ease, color 0.8s ease;
      user-select:none;
      pointer-events:none;
      text-align:left;
      letter-spacing:0.01em;
    }
    .hint.show{ opacity: 1; }

    .btn{
      position:fixed; right:16px; bottom:14px;
      padding:10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.25);
      color: rgba(255,255,255,0.65);
      font-size:12px;
      cursor:pointer;
      backdrop-filter: blur(6px);
      display:none;
    }
    .btn.show{ display:block; }
  </style>
</head>
<body>
  <div class="stage" id="stage"></div>
  <div class="horizon" id="horizon" aria-hidden="true"></div>
  <div class="hint" id="hint">위치 권한이 필요합니다.</div>
  <button class="btn" id="btn">위치 허용</button>

  <script>
    /**
     * 목표:
     * - 점이 아니라 "배경 전체"가 변화
     * - 중앙이 더 밝고, 가장자리가 더 어두운 완만한 라디얼 그라데이션
     * - 기본은 황백빛, 북쪽으로 갈수록 대기왜곡(적갈)이 아주 미세하게 섞임
     * - 37.8 이상이면 완전 블랙
     */

    const LIMIT = 37.8;
    const JEJU  = 33.0;
    const BUSAN = 35.1;
    const SEOUL = 37.6;

    // 서울에서의 최소 가시성(0~1). 전시장 기준 추천 0.25~0.40
    const SEOUL_VIS = 0.63;

    // 그라데이션 강도(과하지 않게)
    // centerGain: 중앙 밝기, edgeDark: 가장자리 어둠
    const centerGain = 0.44;  // 0.10~0.18 추천
    const edgeDark   = 0.96;  // 0.94~0.98 추천

    const stage = document.getElementById('stage');
    const hint = document.getElementById('hint');
    const btn = document.getElementById('btn');
    const horizon = document.getElementById('horizon');

    const clamp01 = (x) => Math.max(0, Math.min(1, x));
    const smoothstep = (e0, e1, x) => {
      const t = clamp01((x - e0) / (e1 - e0));
      return t * t * (3 - 2 * t);
    };

    function visibilityFromLat(lat){
      if (lat >= LIMIT) return 0;

      const base = 1 - smoothstep(JEJU, SEOUL, lat);
      let vis = SEOUL_VIS + (1 - SEOUL_VIS) * base;

      // 37.8 직전(37.7~37.8)에서 급격히 소거
      const nearCut = 1 - smoothstep(LIMIT - 0.10, LIMIT, lat);
      vis *= nearCut;

      return clamp01(vis);
    }

    function rednessFromLat(lat){
      // 남쪽=0(거의 황백), 북쪽=1(왜곡 증가)
      return smoothstep(BUSAN, LIMIT, lat);
    }

    function setBlack(){
      stage.style.background = `radial-gradient(1200px 900px at 50% 55%,
        rgba(0,0,0,0.00) 0%,
        rgba(0,0,0,0.65) 55%,
        rgba(0,0,0,0.98) 88%)`;
      horizon.style.opacity = 0;
      hint.classList.remove('show');
      btn.classList.remove('show');
    }

    function applyState(lat){
      if (lat >= LIMIT){
        setBlack();
        return;
      }

      const vis = visibilityFromLat(lat); // 0..1
      const red = rednessFromLat(lat);    // 0..1

      // 중심 황백빛: vis에 따라 투명도만 변화 (색은 황백 고정)
      const coreA = (0.02 + centerGain * vis).toFixed(3);       // 중앙 밝기(완만)
      const warmA = (0.01 + 0.10 * vis).toFixed(3);             // 중간층 아주 약한 웜
      const redA  = (0.00 + 0.06 * vis * red).toFixed(3);       // 적갈은 "왜곡"으로만

      // 가장자리 어둠: vis가 낮을수록 더 어둡게(너무 과하지 않게)
      const edgeA = (edgeDark + 0.03 * (1 - vis)).toFixed(3);   // 0.96~0.99 근처
      const midA  = (0.10 + 0.10 * vis).toFixed(3);             // 가운데→가장자리 완만 연결

      // 중앙을 살짝 위(55%)로 두면 "시선/지평선" 느낌이 약하게 생김
      stage.style.background = `
        radial-gradient(1200px 900px at 50% 55%,
          rgba(255,252,235,${coreA}) 0%,
          rgba(255,215,170,${warmA}) 32%,
          rgba(255,150,120,${redA}) 48%,
          rgba(10,6,8,${midA}) 70%,
          rgba(0,0,0,${edgeA}) 92%
        )
      `;

      // (선택) 지평선: 거의 보이지 않게, 북쪽/컷 근처에서만 잠깐
      horizon.style.opacity = (vis < 0.18 && vis > 0.03) ? 0.18 : 0.0;
      horizon.style.background = `rgba(255,220,190,${(0.10*vis*(0.4+0.6*red)).toFixed(3)})`;

      hint.classList.remove('show');
      btn.classList.remove('show');
    }

    function fallbackNoLocation(message){
      hint.textContent = message || "위치 권한이 필요합니다.";
      hint.classList.add('show');
      btn.classList.add('show');
    }

    function requestLocation(){
      if (!('geolocation' in navigator)){
        fallbackNoLocation("이 기기에서는 위치 기능을 사용할 수 없습니다.");
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          applyState(lat);
        },
        (err) => {
          if (err && err.code === 1) fallbackNoLocation("위치 권한이 꺼져 있습니다.");
          else if (err && err.code === 3) fallbackNoLocation("위치 응답이 지연됩니다. 다시 시도해주세요.");
          else fallbackNoLocation("위치를 가져올 수 없습니다.");
        },
        { enableHighAccuracy:false, timeout:8000, maximumAge:60_000 }
      );
    }

    btn.addEventListener('click', requestLocation);

    // 자동 실행(원치 않으면 주석)
    requestLocation();
  </script>
</body>
</html>
